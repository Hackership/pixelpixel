<!doctype html>
<head>
	<script src="/js/lodash.min.js"></script>
	<script src="/js/q.js"></script>
	<script src="/js/reqwest.min.js"></script>
	<script src="/js/polymer.min.js"></script>

	<link href="/templates/styles.css" rel="stylesheet" type="text/css" />
	<link href="/stylesheets/styles.css" rel="stylesheet" type="text/css" />

    <link rel="import" href="/elements/pixel/pixel.html">
    <link rel="import" href="/elements/connection/connection.html">
    <link rel="import" href="/elements/pixelwall/pixelwall.html">
    <link rel="import" href="/elements/code/code.html">
    <link rel="import" href="/elements/codeinspector/codeinspector.html">
    <link rel="import" href="/elements/sidebar/sidebar.html">
    <link rel="import" href="/elements/polymer-ui-elements/polymer-ui-tabs/polymer-ui-tabs.html">
    <link rel="import" href="/elements/polymer-elements/polymer-selector/polymer-selector.html">
    <link rel="import" href="/elements/polymer-ui-elements/polymer-ui-splitter/polymer-ui-splitter.html">
</head>
<body>
	<pixel-connection id="connection"></pixel-connection>
	<pixel-codeinspector id="inspector" class="hidden"></pixel-codeinspector>
	<pixel-sidebar>
		<footer>Â©2013 voxelbrain <a href="http://github.com/voxelbrain/pixelpixel">GitHub</a><a href="http://godoc.org/github.com/voxelbrain/pixelpixel/pixelutils">Documentation</a></footer>
	</pixel-sidebar>
	<pixel-pixelwall id="wall"></pixel-pixelwall>
	<script>
		window.addEventListener('WebComponentsReady', function() {
			var conn = document.getElementById('connection');
			var wall = document.getElementById('wall');
			var insp = document.getElementById('inspector');

			conn.addEventListener('pixelCreate', function(ev) {
				var pixel = document.createElement('pixel-pixel');
				pixel.key = ev.detail;
				pixel.id = ev.detail;
				wall.appendChild(pixel);
			});
			conn.addEventListener('pixelChange', function(ev) {
				document.getElementById(ev.detail).update(ev.detail)
				document.getElementById(ev.detail).setCrashed(false);
			});
			conn.addEventListener('pixelCrash', function(ev) {
				document.getElementById(ev.detail).setCrashed(true);
			});
			wall.addEventListener('pixelClick', function(ev) {
				var key = ev.detail.key;
				var pos = {
					x: ev.detail.x,
					y: ev.detail.y,
				};
				conn.reportClick(key, pos);
			});
			wall.addEventListener('showCode', function(ev) {
				insp.key = ev.detail;
				insp.className = '';
			});
			insp.addEventListener('close', function() {
				insp.className = 'hidden';
			});
			conn.href = window.location.host;
		});
	</script>
</body>
